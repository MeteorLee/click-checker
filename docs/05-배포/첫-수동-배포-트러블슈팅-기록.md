# 첫 수동 배포 트러블슈팅 기록

## 1) EC2 설정 세분화 문서 기록 필요
### 인스턴스
- t3.small 선택 (메모리 여유 목적, 비용 발생 가능성 있음)

### 보안 그룹
- SSH: 22 / 내 IP
- App 확인용: 8080 / 내 IP
- Grafana 접속용 : 3030 / 내 IP

### 스토리지
- 30GB 설정

## 2) SSH 접속 pem 키 권한 문제
- PEM 키 권한 이슈 해결:
  - `chmod 400 ~/click-checker.pem`
- 접속:
  - `ssh -i ~/click-checker.pem ubuntu@<EC2_IP>`

## 3) gradle 설치 이슈
- 증상:
  - `./gradlew` 실행 시 Gradle 배포 zip 다운로드에서 `502` 발생
  - 최신 리눅스 배포판에서 보안상의 이유로 `./gradlew` 명령어를 실행 시 자동으로 gradle을 다운받아지는 편의성을 막고 있음
- 대응:
  - 추가적으로 SDKMAN으로 Gradle 설치 후 `gradle clean bootJar`로 우회

## 4) Java 설치 문서 미작성
- 배포 문서에 java 설치 미작성
- `sudo apt install -y openjdk-21-jdk`

## 5) DB 스키마 이슈
- 증상:
  - `ddl-auto=validate` 상태에서 테이블 미존재로 기동 실패
- 임시 대응:
  - `docker-compose.prod.yml`에 `SPRING_JPA_HIBERNATE_DDL_AUTO=update` 추가
- 대응:
  - 첫 배포 과정에서 `ddl-auto=update` 사용
  - 추후에 `ddl-auto=validate`로 변경

## 6) Grafana 포트 충돌
- 증상:
  - `127.0.0.1:3000` bind 충돌로 grafana 시작 실패
- 임시 대응:
  - 기존 3000 점유 프로세스/컨테이너 정리 후 재시도
- 대응 후보:
  - Grafana 포트를 `3300:3000`으로 변경

## 7) git modified 이슈
- 증상:
  - 실제 내용 변경 없이 modified 표시
- 원인 후보:
  - CRLF/LF 줄바꿈 차이
- 대응:
  - `.gitattributes` / git eol 설정 재점검
  - git으로 관리되고 있는 파일들을 재점검(여기서 문제 확인)
